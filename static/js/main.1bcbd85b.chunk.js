(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{26:function(e,t,n){e.exports=n(57)},37:function(e,t,n){},38:function(e,t,n){},57:function(e,t,n){"use strict";n.r(t);var a=n(4),r=n(0),c=n.n(r),o=n(6),i=n.n(o),u=(n(37),n(38),n(7)),l=n.n(u);function s(e){var t=e.sidebar,n=e.main;return c.a.createElement("div",{className:l.a.container},c.a.createElement("div",{className:l.a.sidebar},t),c.a.createElement("div",{className:l.a.main},n))}function E(){return c.a.createElement("div",null,"ChannelsList")}function S(e){var t=e.item,n=e.onEdit,a=e.onResend,r=e.onDelete;return c.a.createElement("div",null,"MESSAGE_STATUS_SENT"===t.status&&c.a.createElement("button",{onClick:function(){n(t)}},"\u270e"),"MESSAGE_STATUS_FAIL"===t.status&&c.a.createElement("button",{onClick:function(){a(t)}},"\ud83d\uddd8"),c.a.createElement("button",{onClick:function(){r(t.id)}},"delete"),c.a.createElement("p",null,!t.removed&&t.content),c.a.createElement("p",null,!t.removed&&t.id),c.a.createElement("p",null,!t.removed&&t.status))}var d=n(1),m=n(5),f=n.n(m),_=n(8),p=n(24),v=n.n(p),b=n(23),A=n.n(b).a.create({baseURL:"https://tahmuras.herokuapp.com/api"}),g=function(){return function(){var e=Object(_.a)(f.a.mark((function e(t,n){var a,r,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n().messages.list.lastSeenId,t({type:"MESSAGES_FETCH_REQUEST",payload:{}}),e.prev=2,e.next=5,A.get("/messages",{params:{lastSeenId:a}});case 5:r=e.sent,c=r.data,t({type:"MESSAGES_FETCH_SUCCESS",payload:{items:c}}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),t({type:"MESSAGES_FETCH_FAILURE",payload:{error:e.t0}});case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,n){return e.apply(this,arguments)}}()},h=function(){var e=Object(_.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(T()),e.prev=1,e.next=4,A.delete("/messages/".concat(n));case 4:t(y(n)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),t(O(e.t0));case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n){return e.apply(this,arguments)}}(),T=function(){return{type:"MESSAGES_DELETE_REQUEST",payload:{}}},O=function(e){return{type:"MESSAGES_DELETE_FAILURE",payload:{e:e}}},y=function(e){return{type:"MESSAGES_DELETE_SUCCESS",payload:{id:e}}},G=function(e){return{type:"MESSAGES_SAVE_MESSAGE",payload:{item:e}}},j=function(e,t){return{type:"MESSAGES_MESSAGE_STATUS_CHANGE",payload:{id:e,status:t}}},M=function(e){return function(){var t=Object(_.a)(f.a.mark((function t(n){var a;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n({type:"MESSAGE_SAVE_REQUEST",payload:{}}),a=Object(d.a)({},e,{id:""===e.id?v()():e.id,status:"MESSAGE_STATUS_PENDING",created:Date.now()}),n(G(a)),t.prev=3,t.next=6,A.post("/messages",a);case 6:n(j(a.id,"MESSAGE_STATUS_SENT")),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(3),console.log(t.t0),n(j(a.id,"MESSAGE_STATUS_FAIL"));case 13:case"end":return t.stop()}}),t,null,[[3,9]])})));return function(e){return t.apply(this,arguments)}}()};function C(){var e=Object(a.c)((function(e){return e.messages.list})),t=e.items,n=e.loading,o=Object(a.b)();Object(r.useEffect)((function(){o(g())}),[o]),Object(r.useEffect)((function(){var e=0;if(!1===n)return e=setTimeout((function(){o(g())}),1e3),function(){return clearTimeout(e)}}),[o,n]);var i=function(e){o(function(e){return{type:"MESSAGE_EDIT",payload:{item:e}}}(e))},u=function(e){M(o)},l=function(e){h(o,e)};return c.a.createElement("div",null,c.a.createElement("ul",null,t.map((function(e){return c.a.createElement("li",{key:e.id},c.a.createElement(S,{item:e,onEdit:i,onResend:u,onDelete:l}))}))))}function U(){var e=Object(a.c)((function(e){return e.messages.edit})).item,t=Object(a.c)((function(e){return e.messages.list})).items,n=Object(a.b)();Object(r.useEffect)((function(){console.log(o),o.current.focus()}),[]),Object(r.useEffect)((function(){setTimeout((function(){o.current.scrollIntoView({behaviour:"smooth",block:"end"})}),1e3)}),[t.length]);var o=Object(r.useRef)(null);return c.a.createElement("form",{onSubmit:function(t){t.preventDefault(),n(M(e))}},c.a.createElement("input",{ref:o,onChange:function(e){var t=e.target.value;n({type:"MESSAGE_CHANGE",payload:{content:{content:t}.content}})},value:e.content}),c.a.createElement("button",null,"Ok"))}function w(){return c.a.createElement("div",null,c.a.createElement(C,null),c.a.createElement(U,null))}function k(){return c.a.createElement(s,{sidebar:c.a.createElement(E,null),main:c.a.createElement(w,null)})}var I=function(){return c.a.createElement(k,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var D=n(3),N={items:[],loading:!1,error:null};var R=Object(D.c)({list:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N;return arguments.length>1&&arguments[1],e}}),L=n(9),x={items:[],loading:!1,error:null,lastSeenId:""};var F={item:{id:"",content:"",status:"MESSAGE_STATUS_PENDING",created:0,removed:!1},loading:!1,error:null};var H=Object(D.c)({list:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"MESSAGES_FETCH_REQUEST":return Object(d.a)({},e,{loading:!0,error:null});case"MESSAGES_FETCH_SUCCESS":var n,a=t.payload.items,r=a.map((function(e){return e.id}));0!==a.length&&(n=a[a.length-1]);var c=n&&n.id||e.lastSeenId;return console.log(a),Object(d.a)({},e,{items:[].concat(Object(L.a)(e.items.filter((function(e){return!r.includes(e.id)}))),Object(L.a)(a)),loading:!1,error:null,lastSeenId:c});case"MESSAGES_FETCH_FAILURE":var o=t.payload.error;return Object(d.a)({},e,{loading:!1,error:o});case"MESSAGES_SAVE_MESSAGE":var i=t.payload.item,u=e.items.find((function(e){return e.id===i.id}));return void 0===u?Object(d.a)({},e,{items:[].concat(Object(L.a)(e.items),[i])}):Object(d.a)({},e,{items:e.items.map((function(e){return e.id===i.id?i:e}))});case"MESSAGES_MESSAGE_STATUS_CHANGE":var l=t.payload,s=l.id,E=l.status;return Object(d.a)({},e,{items:e.items.map((function(e){return e.id===s?Object(d.a)({},e,{status:E}):e}))});case"MESSAGES_DELETE_REQUEST":return Object(d.a)({},e,{loading:!0,error:null});case"MESSAGES_DELETE_SUCCESS":return Object(d.a)({},e,{items:e.items.filter((function(e){return e.id!==t.payload.id}))});default:return e}},edit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"MESSAGE_EDIT":var n=t.payload.item;return Object(d.a)({},e,{item:n});case"MESSAGE_CHANGE":var a=t.payload.content;return Object(d.a)({},e,{item:Object(d.a)({},e.item,{content:a})});case"MESSAGE_SAVE_REQUEST":return{item:Object(d.a)({},F.item),loading:!0,error:null};default:return e}}}),P=n(25),Q=Object(D.c)({channels:R,messages:H}),V=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||D.d,Y=Object(D.e)(Q,V(Object(D.a)(P.a)));i.a.render(c.a.createElement(a.a,{store:Y},c.a.createElement(I,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},7:function(e,t,n){e.exports={container:"Page_container__1Ygh4",scrollY:"Page_scrollY__2nhdZ",sidebar:"Page_sidebar__tlHfx Page_scrollY__2nhdZ",main:"Page_main__M36wb Page_scrollY__2nhdZ"}}},[[26,1,2]]]);
//# sourceMappingURL=main.1bcbd85b.chunk.js.map